# サビアンシンボル機能 開発チェックリスト

## 1. 要件定義・設計

- [ ] **要件確認:** `sabian_requirements.md` の内容をチームで確認し、実装範囲と仕様について合意する。
- [ ] **サビアンシンボルデータ選定:** 使用するサビアンシンボル詩文のデータセット（日本語訳の品質、出典の信頼性など）を最終決定する。
- [ ] **データ形式確定:** `sabian_development.md` に記載のJSON形式でデータを作成することを確定する。
- [ ] **表示設計詳細化:**
    - [ ] ネイタル天体・トランジット天体のサビアンシンボルを具体的に `result.html` のどのテーブルのどの位置に表示するかを決定する。
    - [ ] UI/UX改善案（ツールチップ、モーダル、アコーディオン、ハイライト等）の中から、初期実装するものを選択し、その具体的な動作フローを設計する。
    - [ ] モーダルウィンドウのデザインカンプまたはワイヤーフレームを作成する（任意）。

## 2. データ準備

- [ ] 360個のサビアンシンボル詩文データを収集・整形する。
- [ ] `data/sabian_symbols.json` ファイルを作成し、収集したデータを指定のJSON形式で格納する。
- [ ] JSONデータのバリデーションを行い、構文エラーやデータの欠損がないか確認する。
- [ ] 詩文データの文字コードがUTF-8であることを確認する。

## 3. バックエンド実装 (`utils.py`)

- [ ] サビアンシンボルデータを格納するグローバル変数（例: `sabian_symbols_data`）を定義する。
- [ ] `load_sabian_symbols()` 関数を実装する。
    - [ ] `data/sabian_symbols.json` を開いて読み込む処理を実装する。
    - [ ] JSONデコード処理と、デコード後のデータをグローバル変数に格納する処理を実装する。
    - [ ] ファイルIOエラー、JSONデコードエラーの例外処理を実装する。
- [ ] `get_sabian_symbol(longitude, sign_name_en)` 関数を実装する。
    - [ ] 黄経から星座内度数（0-29.99）を計算するロジックを実装する。
    - [ ] 星座内度数をサビアン度数（1-30の整数）に変換するロジックを実装する。
    - [ ] `sabian_symbols_data` から該当する詩文を検索し、返す処理を実装する。
    - [ ] 該当データがない場合のデフォルト値（空文字列等）を返す処理を実装する。
- [ ] `calculate_horoscope` 関数の修正:
    - [ ] ネイタル天体・感受点ループ内で `get_sabian_symbol()` を呼び出す処理を追加する。
    - [ ] 各天体/感受点の辞書に戻り値を `sabian_symbol` キーで追加する。
- [ ] `calculate_transits` 関数の修正:
    - [ ] トランジット天体ループ内で `get_sabian_symbol()` を呼び出す処理を追加する。
    - [ ] 各トランジット天体の辞書に戻り値を `sabian_symbol` キーで追加する。

## 4. バックエンド実装 (`app.py`)

- [ ] アプリケーション初期化処理に `utils.load_sabian_symbols()` の呼び出しを追加する。
- [ ] `/calculate` ルートで、`result` 辞書にサビアンシンボルを含むデータが正しく渡されていることをデバッグ等で確認する。

## 5. フロントエンド実装 (`result.html`)

- [ ] **ネイタル天体情報表示部分の修正:**
    - [ ] 天体テーブルに「サビアンシンボル」列ヘッダ (`<th>`) を追加する。
    - [ ] 各天体行にサビアンシンボル表示用セル (`<td>`) とテンプレート構文 (`{{ planet.sabian_symbol }}`) を追加する。
- [ ] **トランジット天体情報表示部分の修正:**
    - [ ] 天体テーブルに「サビアンシンボル」列ヘッダ (`<th>`) を追加する。
    - [ ] 各天体行にサビアンシンボル表示用セル (`<td>`) とテンプレート構文 (`{{ transit_planet.sabian_symbol }}`) を追加する。
- [ ] **UI/UX改善機能の実装 (選択したもの):**
    - [ ] **ツールチップ表示:** `title`属性に詩文全体を設定するか、JavaScriptライブラリ（例: Tippy.js, Popper.js）を導入してカスタムツールチップを実装する。
    - [ ] **モーダル表示:**
        - [ ] モーダル用のHTML構造（背景オーバーレイ、コンテンツエリア、閉じるボタン等）を作成する。
        - [ ] サビアンシンボル表示セルクリック時に、対応する詩文をモーダルにセットして表示するJavaScriptを記述する。
    - [ ] **アコーディオン表示:**
        - [ ] アコーディオンのヘッダー（天体名など）とコンテンツ（詩文）部分のHTML構造を作成する。
        - [ ] ヘッダークリックでコンテンツの表示/非表示を切り替えるJavaScriptを記述する。

## 6. フロントエンド実装 (`style.css`)

- [ ] サビアンシンボル表示セルのスタイル（パディング、テキストの折り返し、最大幅など）を調整する。
- [ ] UI/UX改善で実装したツールチップ、モーダル、アコーディオンのスタイルを定義する。
    - [ ] モーダルの表示位置、サイズ、背景、テキストスタイル。
    - [ ] アコーディオンのヘッダーとコンテンツのスタイル、開閉時のアニメーション（任意）。
- [ ] 全体的なデザインとの調和を意識し、詩文の可読性を高めるフォントや配色を適用する。

## 7. テスト

- [ ] **データロードテスト:** アプリケーション起動時にエラーなく `sabian_symbols.json` がロードされることを確認。
- [ ] **単体テスト (`utils.py`):**
    - [ ] `get_sabian_symbol` 関数に対し、各星座の境界値（0度、1度、29度、29.99度）や代表的な度数を与え、正しい詩文が返るかテストする。
- [ ] **結合テスト:**
    - [ ] 様々な生年月日・時刻でホロスコープを計算し、ネイタルとトランジットの各天体にサビアンシンボルが正しく表示されるか確認する。
    - [ ] 天体の度数が0度ちょうどの場合は、その星座の1度のサビアンシンボルが表示されることを確認する。
    - [ ] 天体の度数が29.xx度の場合は、その星座の30度のサビアンシンボルが表示されることを確認する。
- [ ] **フロントエンドテスト:**
    - [ ] UI/UX改善機能（ツールチップ、モーダル、アコーディオン等）が全ての対象要素で正しく動作することを確認する。
    - [ ] レスポンシブデザインの場合、異なる画面サイズで表示崩れがないか確認する。
    - [ ] 主要ブラウザ（Chrome, Firefox, Safari, Edge）での動作確認。
- [ ] **ユーザビリティテスト:** 実際に操作してみて、詩文が読みやすいか、操作が直感的かを確認する。

## 8. ドキュメント・その他

- [ ] 追加・修正したPythonコード、JavaScriptコード、CSSに適切なコメントを記述する。
- [ ] `README.md` または関連ドキュメントに、サビアンシンボル機能の概要、使用方法、データ出典（もしあれば）を追記する。
- [ ] (任意) サビアンシンボルデータの出典元へのリンクや参考文献を記載する。
- [ ] 全ての変更をバージョン管理システム（Git）にコミットし、適切なブランチ運用を行う。 