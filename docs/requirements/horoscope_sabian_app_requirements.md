# ホロスコープ・サビアンシンボル表示アプリ 要件定義書

## 1. 目的

ユーザーが指定した生年月日、出生時刻、出生地に基づき、ネイタルホロスコープ（出生図）を計算し、天体の位置情報、天体間のアスペクト、各天体に対応するサビアンシンボル、およびそれらに基づく基本的な解釈を分かりやすく表示します。さらに、ユーザーが指定した未来または過去の日時（トランジット日時）における天体の影響（トランジット）を計算・表示し、時期読みの一助とします。また、表示された結果を「ホロスコープの読み解き」と「サビアンシンボルの読み解き」の2種類のPDFファイルとして出力・ダウンロードできる機能を提供します。これにより、ユーザーは自己の占星術的な特徴や可能性、特定の時期の運勢傾向についての洞察を得て、その記録を保存・共有する一助とします。

## 2. 機能要件

### 2.1 入力機能
-   ユーザーは以下の情報を入力できること:
    -   生年月日（年、月、日）
    -   出生時刻（時、分）
    -   出生地の経度・緯度（または主要都市からの選択、あるいは地名検索によるジオコーディング機能）
    -   タイムゾーン（デフォルトはJST (UTC+9)、選択可能とすることを検討）
    -   ハウスシステム（デフォルトはPlacidus、選択可能とすることを検討）
    -   **トランジット日時**（年月日、任意で時刻。デフォルトは現在日時）
-   入力値のバリデーションを行い、不正な形式の場合はエラーメッセージを表示すること。

### 2.2 計算機能
-   **ネイタルホロスコープ計算:**
    -   入力された情報に基づき、主要な天体（太陽、月、水星、金星、火星、木星、土星、天王星、海王星、冥王星）の黄経座標（サインと度数）を計算する。
    -   主要な感受点（アセンダント(ASC)、ミッドヘブン(MC)）の黄経座標を計算する。
    -   各天体および感受点のハウス位置を計算する（ハウスシステムはプランシーダスをデフォルトとし、可能であれば他のシステムも選択可能とすることを検討）。
-   **アスペクト計算:**
    -   ネイタルチャートの天体間（主要天体同士、および主要天体とASC/MC間）に形成される主要なアスペクト（合、衝、三分、四分、六分など）を計算する。
    -   アスペクト計算時には、適切なオーブ（許容度数差）を設定する。
-   **サビアンシンボル特定:**
    -   計算された各主要天体および主要感受点（ASC, MCを主とする。太陽、月も重要）の正確な度数（小数点以下を切り上げ）に対応するサビアンシンボルを特定する。
    -   サビアンシンボルの詩文データ（360個）を内包するか、外部ファイル（例: JSON）から読み込む。
-   **解釈文データ準備 (簡易):**
    -   主要な天体（太陽〜冥王星、ASC、MC）の各サインにおける基本的な性質の解説文テンプレート。
    -   主要な天体の各ハウスにおける基本的な意味の解説文テンプレート。
    -   主要なアスペクト（天体ペアとアスペクト種類）に対する基本的な解釈のキーワードや短文テンプレート。
-   **トランジット計算:**
    -   ユーザーが指定したトランジット日時における主要な天体（太陽～冥王星）の位置（黄経座標）を計算する。
    -   トランジット天体と、ユーザーのネイタルチャートの天体および感受点（ASC, MC）との間に形成される主要なアスペクト（合、衝、三分、四分、六分など）を計算する。
        -   アスペクト計算時には、トランジット用の適切なオーブを設定する。
    -   トランジット天体のサビアンシンボルを特定する。

### 2.3 表示機能
-   **入力情報表示:**
    -   ユーザーが入力した生年月日、出生時刻、出生地（経緯度）、タイムゾーン、ハウスシステムを表示する。
    -   トランジット計算を行った場合は、その基準日時も表示する。
-   **天体の位置表示 (ネイタル):**
    -   主要10天体、ASC、MCについて、以下の情報をテーブル形式で表示する。
        -   天体名
        -   サイン（例: 牡牛座）
        -   度数（例: 25°14'）
        -   ハウス番号
        -   天体記号
-   **天体の位置とサビアンシンボル表示 (ネイタル):**
    -   主要10天体（ASC、MCも含むことを検討）について、以下の情報をテーブル形式で表示する。
        -   天体名
        -   星座名
        -   星座内度数（10進数表記、例: 25.6°）
        -   対応するサビアンシンボルの詩文
-   **アスペクトリスト表示:**
    -   計算されたネイタルアスペクトをリスト形式（またはテーブル形式）で表示する。
        -   例: 火星 △ ASC (Trine, オーブ: 0.0°)
        -   表示内容: 天体1、アスペクト記号、天体2、アスペクト名（英語/日本語）、オーブ。
-   **アスペクトグリッド表示:**
    -   主要10天体とASC、MCを軸としたマトリクス形式で、各ペア間のアスペクト記号を表示する。
-   **総合的な読み解き表示 (簡易):**
    -   主要な天体（例: 太陽、月、水星、金星、火星など）について、その天体が存在するサインとハウスの組み合わせから、基本的な性格や傾向に関する短い解説文を生成して表示する。
        -   例: 「太陽（基本的な自己、生命力、意志）は牡牛座にあり、忍耐強く、安定を好む。美的感覚に優れています。これが第6ハウスにあるため、人生の「仕事、健康、義務、奉仕」の領域で基本的な自己や意志が影響を与えやすいでしょう。」
-   **アスペクト解説表示 (簡易):**
    -   形成されている主要なネイタルアスペクトの中からいくつかピックアップし、そのアスペクトが持つ基本的な意味や影響に関する短い解説文を表示する。
        -   例: 「♂ △ Asc: あなたの「火星（行動力、情熱、意欲、闘争心）」と「ASC（自己自身、個性、第一印象）」のエネルギーは、「調和・安定」の関係にあります。これは、関連するテーマであなたの才能や個性がスムーズに発揮されやすく、調和的なエネルギーが働いていることを示唆しています。（△, オーブ 0.0°）」
-   **ホロスコープチャート図表示:**
    -   ホロスコープチャート（円形の図）をグラフィカルに表示する。天体、サイン、ハウス、アスペクト線などを含む。
    -   **(任意) 二重円（バイホイール）表示:** ネイタルチャートの外側にトランジットチャートを重ねて表示する。
-   **PDF出力ボタン:**
    -   「ホロスコープ読み解きをPDFでダウンロード」ボタンと「サビアンシンボル読み解きをPDFでダウンロード」ボタンを設置する。
-   **トランジット情報表示:**
    -   **トランジット天体位置表示:** 指定されたトランジット日時における各天体のサイン、度数、(可能であれば)サビアンシンボルをテーブル形式で表示する。
    -   **トランジット-ネイタル アスペクト表示:** トランジット天体がネイタルチャートのどの天体/感受点に対してどのアスペクトを形成しているかをリスト形式で表示する。アスペクトの種類、オーブも表示する。
    -   **(任意) トランジット-ネイタル アスペクト解説表示 (簡易):** 主要なトランジット-ネイタルアスペクトについて、基本的な影響に関する短い解説文を表示する。

### 2.4 PDF出力内容
-   **ホロスコープ読み解きPDF:**
    -   ファイル名: `horoscope_interpretation_YYYYMMDD_HHMM.pdf` (例: `horoscope_interpretation_19780516_1030.pdf`)
    -   入力情報（生年月日、出生時刻、出生地、タイムゾーン、ハウスシステム、トランジット計算日時）
    -   天体の位置表示（ネイタル）
    -   アスペクトリスト表示（ネイタル）
    -   アスペクトグリッド表示（ネイタル）
    -   総合的な読み解き表示（ネイタル天体のサイン・ハウス解釈）
    -   アスペクト解説表示（ネイタル）
    -   ホロスコープチャート図（ネイタル、可能であればトランジットとの二重円）
    -   トランジット天体位置表示（トランジット計算時）
    -   トランジット-ネイタル アスペクト表示（トランジット計算時）
    -   (任意) トランジット-ネイタル アスペクト解説表示（トランジット計算時）
-   **サビアンシンボル読み解きPDF:**
    -   ファイル名: `sabian_symbols_YYYYMMDD_HHMM.pdf` (例: `sabian_symbols_19780516_1030.pdf`)
    -   入力情報（生年月日、出生時刻、出生地、タイムゾーン、ハウスシステム）
    -   天体の位置とサビアンシンボル表示（ネイタル：天体名、星座名、星座内度数、サビアン詩文）
    -   (任意) 各ネイタル天体のサビアンシンボルに関する追加的なキーワードや短い解釈（今回のスコープでは詩文のみを必須とする）
    -   トランジット天体の位置とサビアンシンボル表示（トランジット計算時：トランジット天体名、星座名、星座内度数、サビアン詩文）

## 3. 非機能要件
-   **計算精度:** 天体位置計算には、実績のある計算ライブラリ（例: Swiss Ephemeris）を使用し、十分な精度を確保する。
-   **パフォーマンス:** 入力から結果表示までの応答速度は、ユーザーがストレスを感じない程度であること。
-   **ユーザビリティ:** 入力フォームや結果表示は直感的で分かりやすく、専門知識がないユーザーでも操作・理解しやすいように配慮する。
-   **可読性:** 表示される情報は、適切なフォントサイズ、配色、レイアウトで読みやすくする。
-   **エラーハンドリング:** 計算エラーや不正な入力に対して、適切なエラーメッセージをユーザーに分かりやすく表示する。
-   **PDF出力品質:** 出力されるPDFは、画面表示に近いレイアウトで、文字や図が鮮明であること。ファイルサイズが過度に大きくならないように配慮する。
-   **データ管理:** サビアンシンボルデータおよび簡易解釈文テンプレートは保守しやすい形式（例: JSONファイル）で管理する。

## 4. スコープ外（今回の実装では含めない）
-   プログレッション（進行）計算・表示機能、ソーラーアーク予測などの未来予測機能（トランジット機能は今回スコープに含めるが、プログレッション等のより高度な未来予測はスコープ外とする）。
-   春分点チャートなどの特殊なチャート表示機能。
-   相性診断（シナストリー、コンポジット）機能。
-   詳細な占星術的解釈文の自動生成・表示（サビアンシンボルの詩文表示と、本要件定義書2.3に記載の簡易的な読み解き・アスペクト解説はスコープ内）。
-   ユーザーアカウント機能、データ保存機能。
-   PDFや画像での出力機能（現時点では画面表示を主とする）。
-   小惑星、感受点（ドラゴンヘッド、リリス等）の追加表示（主要10天体+ASC/MCを優先）。
-   PDF出力における高度なカスタマイズ機能（項目選択、レイアウト変更など）。 