# 高度なチャート表示 要件定義書

## 1. 概要

「スターゲイザー」アプリケーションの高度チャート表示モジュールは、占星術チャートの視覚的表現を拡張し、より多くの情報をわかりやすく提示するシステムです。本モジュールは三重円チャート、アスペクトパターン検出、調和分析チャート、アラビックパーツと固定星表示、ダイナミックタイムマップ機能を実装します。

## 2. 目的

- 複数チャート（ネイタル、プログレッション、トランジット）の同時表示による比較分析を可能にする
- 複雑な占星術パターンやデータを視覚的に理解しやすい形で提示する
- ユーザーが自分のホロスコープを時間軸に沿って動的に理解できるようにする

## 3. 機能要件

### 3.1 三重円チャート機能

| 要件ID | 要件名 | 説明 | 優先度 |
|--------|--------|------|--------|
| TC-01 | 三重円基本表示 | ネイタル-プログレッション-トランジットの同心円表示 | 高 |
| TC-02 | チャート切替機能 | 表示するチャート組み合わせを自由に選択可能 | 中 |
| TC-03 | 天体表示フィルター | 表示する天体を選択的にフィルタリング可能 | 高 |
| TC-04 | カスタム色設定 | チャート層ごとに異なる色設定可能 | 中 |
| TC-05 | ズーム機能 | チャートの拡大・縮小・特定部分フォーカス機能 | 中 |
| TC-06 | 印刷・保存対応 | 高解像度でのエクスポート・印刷対応 | 低 |

### 3.2 アスペクトパターン検出機能

| 要件ID | 要件名 | 説明 | 優先度 |
|--------|--------|------|--------|
| AP-01 | パターン自動検出 | 主要なアスペクトパターンの自動検出アルゴリズム | 高 |
| AP-02 | 検出パターン種類 | グランドトライン、Tスクエア、ヨッド、ミスティックレクタングル等の検出 | 高 |
| AP-03 | パターン視覚化 | 検出されたパターンの視覚的ハイライト表示 | 高 |
| AP-04 | パターン解釈 | 検出パターンの総合的な意味解釈の生成 | 中 |
| AP-05 | パターン閾値設定 | パターン検出の精度・オーブ設定のカスタマイズ | 低 |
| AP-06 | 複合パターン検出 | 複数チャートにまたがるパターンの検出 | 低 |

### 3.3 調和分析チャート機能

| 要件ID | 要件名 | 説明 | 優先度 |
|--------|--------|------|--------|
| HA-01 | エレメント分布 | 火・地・風・水の分布バランスの視覚化 | 高 |
| HA-02 | モダリティ分布 | 活動宮・不動宮・柔軟宮の分布バランスの視覚化 | 高 |
| HA-03 | 星座分布 | 12星座における天体分布の視覚化 | 中 |
| HA-04 | ハウス分布 | 12ハウスにおける天体分布の視覚化 | 中 |
| HA-05 | 天体強度計算 | 位置・アスペクト・支配関係に基づく天体強さの数値化 | 高 |
| HA-06 | ディスポジター分析 | 天体の支配連鎖と最終ディスポジターの視覚的表現 | 中 |

### 3.4 アラビックパーツと固定星機能

| 要件ID | 要件名 | 説明 | 優先度 |
|--------|--------|------|--------|
| AF-01 | アラビックパーツ計算 | 主要アラビックパーツの自動計算（運命の車輪、富の部分等） | 中 |
| AF-02 | アラビックパーツ表示 | チャート上でのアラビックパーツ視覚化 | 中 |
| AF-03 | 固定星計算 | 主要固定星との合(シリウス、アルゴル、スピカ等)の計算 | 中 |
| AF-04 | 固定星表示 | チャート上での固定星位置の視覚化 | 低 |
| AF-05 | 特殊点計算 | ブラックムーン・リリス、キローン等の特殊点計算 | 中 |
| AF-06 | 解釈テキスト | アラビックパーツ・固定星合の意味解釈テキスト | 低 |

### 3.5 ダイナミックタイムマップ機能

| 要件ID | 要件名 | 説明 | 優先度 |
|--------|--------|------|--------|
| DT-01 | トランジット強度グラフ | 時間軸に沿ったトランジットアスペクト強度のグラフ表示 | 高 |
| DT-02 | タイムスライダー | 任意の時間位置を選択できるスライダーコントロール | 高 |
| DT-03 | アスペクト変化アニメーション | 過去から未来へのアスペクト形成・解消のアニメーション | 中 |
| DT-04 | 重要イベント表示 | タイムライン上の重要占星術イベントのマーキング | 高 |
| DT-05 | カスタム期間設定 | 表示する時間範囲の自由設定 | 中 |
| DT-06 | 予測連携 | 予測モジュールとの連携による統合タイムライン | 中 |

## 4. 非機能要件

### 4.1 パフォーマンス要件

- 三重円チャートのレンダリングは2秒以内に完了すること
- 大量のデータ表示時でも操作レスポンスが0.5秒以内であること
- モバイルデバイスでも適切なパフォーマンスを維持すること

### 4.2 互換性要件

- 主要ブラウザ（Chrome、Firefox、Safari、Edge）で正常動作すること
- デスクトップ・タブレット・スマートフォンで適切に表示されること
- 異なる解像度・画面サイズに対応すること

### 4.3 使いやすさ要件

- 初心者でも直感的に操作できるインターフェース設計
- ヘルプ機能およびツールチップによる操作ガイダンス
- アクセシビリティガイドラインへの準拠

### 4.4 信頼性要件

- チャート描画エラー発生率0.1%以下
- ブラウザのリソース使用を最適化し、クラッシュを防止
- データ損失なくページリロードが可能なセッション保持

## 5. 技術要件

### 5.1 フロントエンド技術

- SVGまたはHTML5 Canvasを用いたチャートレンダリング
- モダンなJavaScriptフレームワーク（Vue.js）の使用
- レスポンシブWebデザイン対応

### 5.2 バックエンド技術

- 天体位置計算エンジン（Swiss Ephemeris）との連携
- データキャッシュシステムによるパフォーマンス最適化
- RESTful APIによるフロントエンドとの通信

### 5.3 データ要件

- チャート設定のユーザープリファレンス保存
- 複数チャートデータの効率的な保存構造
- 視覚化用中間データフォーマットの設計

## 6. 制約事項

- ブラウザのメモリ制限内での動作確保
- モバイルデバイスの画面サイズに対応した表示調整
- 初回読み込み時のデータ転送量最適化

## 7. 想定ユーザー

- 占星術の基礎知識を持つユーザー
- 詳細なチャート分析を求める中〜上級者
- 視覚的情報から直感的に理解したい初心者

## 8. 依存関係

- 天体位置計算モジュール
- 既存のネイタルチャート表示システム
- ユーザー認証・データ保存システム

## 9. 成功基準

- ユーザーテストで85%以上が「わかりやすい」と評価
- チャート表示に関連するサポート問い合わせ30%減少
- 新機能実装後のエンゲージメント20%向上 