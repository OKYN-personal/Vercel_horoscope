# PDF出力機能 開発チェックリスト

## 1. 要件定義・設計

- [ ] **要件確認:** `pdf_output_requirements.md` の内容を確認し、実装範囲を明確にする。
- [ ] **PDFファイル名の確定:** 提供するPDFファイル名 (`horoscope_1978-05-16.pdf`, `horoscope_result.pdf`) を再確認する。
- [ ] **PDF配置場所決定:** PDFファイルを格納するディレクトリ構造を決定する (例: `static/pdf/`)。
- [ ] **ダウンロードインターフェース設計:** HTMLページにどのようにダウンロードリンク/ボタンを配置するか、文言などを決定する。
- [ ] **バックエンド処理検討:** Flaskの `send_from_directory` を利用するか、静的ファイルへの直接リンクとするか方針を決定する (手順書では両方記載があるが、どちらかを選択)。

## 2. ファイル準備

- [ ] `horoscope_1978-05-16.pdf` を準備する。
- [ ] `horoscope_result.pdf` を準備する。
- [ ] 決定したディレクトリ (例: `static/pdf/`) を作成し、上記2つのPDFファイルを配置する。

## 3. バックエンド実装 (Flaskアプリケーション)

*以下の項目は、バックエンドで専用のダウンロードルートを作成する場合に実施*
- [ ] 必要なモジュール (`send_from_directory`, `os`) をインポートする。
- [ ] PDFファイルが格納されているディレクトリのパスを定義する (例: `PDF_DIRECTORY`)。
- [ ] `/download_pdf/<filename>` のようなルートと対応する関数 (例: `download_pdf(filename)`) を作成する。
    - [ ] 受け取った `filename` が許可されたファイル名（`horoscope_1978-05-16.pdf` または `horoscope_result.pdf`）であるか検証するロジックを実装する。
    - [ ] `send_from_directory` を使用して、ファイルを `as_attachment=True` で送信する処理を実装する。
    - [ ] ファイルが見つからない場合の例外処理 (404エラーなど) を実装する。
- [ ] 作成したルートをFlaskアプリケーションに登録する。

## 4. フロントエンド実装 (HTMLテンプレート)

- [ ] PDFダウンロードリンクを設置するHTMLページを特定または新規作成する。
- [ ] **ダウンロードリンク1 (`horoscope_1978-05-16.pdf`):**
    - [ ] `<a>` タグでリンクを作成する。
    - [ ] `href` 属性を適切に設定する (専用ルートを使用する場合は `url_for('download_pdf', filename='horoscope_1978-05-16.pdf')`、静的ファイルの場合は `url_for('static', filename='pdf/horoscope_1978-05-16.pdf')`)。
    - [ ] リンクテキストを「ホロスコープサンプル (1978-05-16) をダウンロード」など、分かりやすいものにする。
    - [ ] (静的ファイルの場合) `download` 属性を追加することを検討する。
- [ ] **ダウンロードリンク2 (`horoscope_result.pdf`):**
    - [ ] `<a>` タグでリンクを作成する。
    - [ ] `href` 属性を適切に設定する (専用ルートを使用する場合は `url_for('download_pdf', filename='horoscope_result.pdf')`、静的ファイルの場合は `url_for('static', filename='pdf/horoscope_result.pdf')`)。
    - [ ] リンクテキストを「ホロスコープ結果サンプルをダウンロード」など、分かりやすいものにする。
    - [ ] (静的ファイルの場合) `download` 属性を追加することを検討する。
- [ ] (任意) ダウンロードセクション全体の見た目をCSSで調整する。

## 5. テスト

- [ ] `horoscope_1978-05-16.pdf` のダウンロードリンクをクリックし、ファイルが正しくダウンロードされることを確認する。
    - [ ] ファイル名が `horoscope_1978-05-16.pdf` であること。
    - [ ] ダウンロードしたPDFファイルが開け、内容が期待通りであること。
- [ ] `horoscope_result.pdf` のダウンロードリンクをクリックし、ファイルが正しくダウンロードされることを確認する。
    - [ ] ファイル名が `horoscope_result.pdf` であること。
    - [ ] ダウンロードしたPDFファイルが開け、内容が期待通りであること。
- [ ] (バックエンドルートを作成した場合) 許可されていないファイル名をURLで指定してアクセスし、404エラーなどが返ることを確認する。
- [ ] (バックエンドルートを作成し、ファイルがサーバーに存在しない場合) 該当ファイルのダウンロードを試み、404エラーなどが返ることを確認する。
- [ ] 各ブラウザ（Chrome, Firefoxなど）でダウンロード機能が動作することを確認する。
- [ ] ダウンロードリンクの表示テキスト、配置が要件通りであることを確認する。

## 6. ドキュメント・その他

- [ ] 追加・修正したコードにコメントを記述する。
- [ ] (必要であれば) `README.md` や関連ドキュメントに機能追加に関する情報を追記する。
- [ ] Git に変更をコミットする。 